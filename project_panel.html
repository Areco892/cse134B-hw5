<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Projects Panel</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" href="img/favicon.png" type="image/png">
    <style>
        main {
            padding: 7rem;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            text-align: center;
            gap: 1rem;

            h2 {
                width: 100%;
                font-size: var(--h2-font-size);
                padding: 1rem;
            }

            h3 {
                font-size: var(--h3-font-size);
            }

            button {
                border: var(--border);
                border-radius: var(--border-radius);
                background-color: var(--bg-color);
                color: var(--text-color);
                font-family: var(--text-font);
                padding: 0.5rem;
                cursor: pointer;
                align-self: center;
            }

            button:hover {
                background-color: #fdbcbc;
            }

            #existingProjects {
                display: flex;
                flex-direction: column;
                border: var(--border);
                border-radius: var(--border-radius);
                gap: 1rem;
                padding: 2rem;
                width: clamp(25rem, 30vw, 100%);

                project {
                    display: flex;
                    flex-direction: row;
                    justify-content: space-between;
                    flex-basis: 1;
                    margin: 1rem;

                    h4 {
                        flex: 1;
                        text-align: start;
                    }
                }
            }

            form {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                padding: 2rem;
                width: 30rem;
                justify-self: center;
                border: var(--border);
                border-radius: var(--border-radius);

                label {
                    text-align: start;
                }

                input {
                    background-color: var(--bg-color);
                    border: var(--border);
                    border-radius: var(--border-radius);
                    color: var(--text-color);
                    padding: 0.5rem;
                }
            }
        }
    </style>
    <script>
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === "light" || savedTheme === "dark") {
            document.documentElement.setAttribute('data-theme', savedTheme);
        } else {
            const custom = JSON.parse(savedTheme);
            document.documentElement.style.setProperty('--custom-bg-color', custom.bg);
            document.documentElement.style.setProperty('--custom-text-color', custom.text);
            document.documentElement.style.setProperty('--custom-text-font', custom.font);
            document.documentElement.classList.add("custom-theme");
        }
    </script>
</head>


<body>

    <header>
        <h1>Alexander Huang</h1>
        <button id="theme-toggle" aria-label="Toggle dark mode">Theme</button>

        <form id="theme-form" class="hidden">
            <button id="light-dark" type="button">Light/Dark</button>

            <label for="background-color">Background Color: </label>
            <input id="background-color" name="background-color" type="color">

            <label for="text-color">Text Color: </label>
            <input id="text-color" name="text-color" type="color">

            <label for="text-font">Text Font: </label>
            <select id="text-font" name="text-font">
                <option value="Arial">Arial</option>
                <option value="Georgia">Georgia</option>
                <option value="Courier">Courier</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Comic Sans MS">Comic Sans MS</option>
            </select>

            <button id="theme-pick" type="button">Apply</button>
        </form>

        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="resume.html">Resume</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>
    <hr>

    <main>
        <h2>Projects Panel</h2>

        <section id="existingProjects">
            <h3>Projects Saved on Local</h3>
            <local-projects id="localProjects"></local-projects>
            <button id="createBtn" type="button">Add New Project to Local</button>
        </section>

        <form id="projectForm">
            <h3>Create/Update Projects</h3>

            <input type="hidden" id="projectID" name="projectID" value="">

            <label for="title">Title </label>
            <input id="title" type="text" name="title">

            <label for="src">Image Source </label>
            <input id="src" type="text" name="src">

            <label for="alt">Image Alt Text</label>
            <input id="alt" type="text" name="alt">

            <label for="description">Description</label>
            <input id="description" type="text" name="description">

            <label for="link">Link</label>
            <input id="link" type="text" name="link">

            <button id="saveBtn" type="button">Save Project</button>

        </form>


    </main>

    <script src="script.js"></script>
    <script>
        const form = document.getElementById("projectForm");
        const localProjects = document.getElementById("localProjects");
        const projectID = document.getElementById("projectID");
        const createBtn = document.getElementById("createBtn");
        const saveBtn = document.getElementById("saveBtn");

        /**
         * Initial render of the existing projects 
         */
        loadProjects();

        /**
         * Attach event listener to the buttons on project panel 
         */
        createBtn.addEventListener('click', clearForm)
        saveBtn.addEventListener('click', projectCreateUpdate)
        localProjects.addEventListener('click', projectClicked)

        /**
         * Render the projects that currently exists on local storage 
         */
        function loadProjects() {
            const localData = JSON.parse(localStorage.getItem('projects'));
            if (localData) {
                displayData(localData);
            } else {
                console.log('No data in localStorage.');
            }
        }
        function displayData(data) {
            localProjects.innerHTML = '';

            data.forEach((project, index) => {
                const projectCard = document.createElement('project');
                projectCard.innerHTML = `
                    <h4>${project.title}</h4>
                    <action-buttons>
                        <button>Edit</button>
                        <button>Delete</button> 
                    </action-buttons>
                `;
                projectCard.setAttribute('id', `project${index}`);
                localProjects.appendChild(projectCard);
            });
        }

        /**
         * Save project button from the form (used to create or update a project) 
         */
        function projectCreateUpdate() {
            const project = {
                title: form.title.value,
                src: form.src.value,
                alt: form.alt.value,
                description: form.description.value,
                link: form.link.value
            };
            if (projectID.value !== "") {
                updateProject(projectID.value, project);
                clearForm();
            } else {
                createProject(project);
                clearForm();
            }
        };

        /**
         * Create a new project
         */
        function createProject(newProject) {
            const projects = JSON.parse(localStorage.getItem("projects")) || [];
            projects.push(newProject);
            localStorage.setItem("projects", JSON.stringify(projects));

            loadProjects();
        }

        /**
         * Update an existing project 
         */
        function updateProject(index, project) {
            const localProjects = JSON.parse(localStorage.getItem("projects"));
            localProjects[index] = project;
            localStorage.setItem("projects", JSON.stringify(localProjects));

            loadProjects();
        }

        /**
         * Clear the form and register the user's input to create a new project card 
         */
        function clearForm() {
            form.title.value = "";
            form.src.value = "";
            form.alt.value = "";
            form.description.value = "";
            form.link.value = "";
            projectID.value = "";
        }

        /**
         * Handle the Edit and Delete Button 
         */
        function projectClicked(event) {
            const projectCard = event.target.closest('project');
            const id = parseInt(projectCard.getAttribute('id').slice(7));
            const project = JSON.parse(localStorage.getItem('projects'))[id]
            if (event.target.innerHTML === 'Edit') {
                editProject(project, id);
            }
            else if (event.target.innerHTML === 'Delete') {
                deleteProject(id);
            }
        }

        /**
         * Fill the form with the data of the existing project card 
         */
        function editProject(project, id) {
            form.title.value = project.title;
            form.src.value = project.src;
            form.alt.value = project.alt;
            form.description.value = project.description;
            form.link.value = project.link;
            projectID.value = id;
        }

        /**
         * Delete a project from local storage 
         */
        function deleteProject(index) {
            const localProjects = JSON.parse(localStorage.getItem('projects'));
            localProjects.splice(index, 1);
            localStorage.setItem('projects', JSON.stringify(localProjects));

            loadProjects();
        }

    </script>

    <noscript>To toggle the themes, JavaScript must be activated.</noscript>
</body>


</html>